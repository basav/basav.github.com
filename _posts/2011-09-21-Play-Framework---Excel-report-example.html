---           
layout: post
title: Play Framework - Excel report example
date: Wed Sep 21 17:10:49 UTC 2011
updated: Wed Sep 21 17:10:49 UTC 2011
comments: false
categories: play-framework tech topics
---

It's breeze to create excel reports using Play framework. Let me run thru an example.<br />Let's create a sample project - excel-example.<br /><pre class="brush: bash">$ play new excel-example<br /></pre>Then eclipsify and import into eclipse.<br /><pre class="brush: bash">$ play eclipsify excel-example<br /></pre>Edit the dependencies.yml and include the <a href="http://www.playframework.org/modules/excel-1.2.3/home">excel module</a><br /><pre class="brush: java"># Application dependencies<br />require:<br />    - play 1.2.3<br />    - play -&gt; excel 1.2.3<br /></pre>Run the play dependencies command. Play connects to the web and downloads the excel-module into the modules directory<br /><pre class="brush: bash">$ play deps excel-example<br />~        _            _ <br />~  _ __ | | __ _ _  _| |<br />~ | '_ \| |/ _' | || |_|<br />~ |  __/|_|\____|\__ (_)<br />~ |_|            |__/   <br />~<br />~ play! 1.2.3, http://www.playframework.org<br />~<br />~ Resolving dependencies using /Users/play/excel-example/conf/dependencies.yml,<br />~<br />~  play-&gt;excel 1.2.3 (from playLocalModules)<br />~<br />~ Installing resolved dependencies,<br />~<br />~  modules/excel-1.2.3 -&gt; /Users/play/frameworks/play-1.2.3/modules/excel-1.2.3<br />~<br />~ Done!<br />~<br /></pre>Plays excel module uses <a href="http://jxls.sourceforge.net/">jxls</a> internally which uses <a href="http://poi.apache.org/overview.html">Apache POI</a> library - the one and only one library in Java world for excel manipulation. All the dependencies of jxls are bundled with excel-module and dependencies managed. <br />However there is one <a href="http://poi.apache.org/oxml4j/index.html">additional library</a> that would be required to ouptut xslx excel formats - which is the newer format depending on Office Open XML documents. This is because xslx is basically a zip format.<br />Download the <a href="http://repo1.maven.org/maven2/org/apache/poi/ooxml-schemas/1.1/">ooxml-schemas-1.1.jar</a> from the maven repository and put it in the lib directory of the excel-example project.<br />Then eclipsify again so that eclispe classpath reflects the new dependencies.<br /><pre class="brush: bash">$ play eclipsify excel-example<br /></pre>Refresh the Project in eclipse.<br /><b>Start the play server.</b><br /><pre class="brush: bash">$ play run excel-example<br />~        _            _ <br />~  _ __ | | __ _ _  _| |<br />~ | '_ \| |/ _' | || |_|<br />~ |  __/|_|\____|\__ (_)<br />~ |_|            |__/   <br />~<br />~ play! 1.2.3, http://www.playframework.org<br />~<br />~ Ctrl+C to stop<br />~ <br />JPDA port 8000 is already used. Will try to use any free port for debugging<br />Listening for transport dt_socket at address: 50675<br />00:54:21,975 INFO  ~ Starting /Users/play/excel-example<br />00:54:21,979 INFO  ~ Module excel is available (/Users/play/frameworks/play-1.2.3/modules/excel-1.2.3)<br />00:54:22,603 WARN  ~ You're running Play! in DEV mode<br />00:54:22,769 INFO  ~ Listening for HTTP on port 9000 (Waiting a first request to start) ...<br /></pre>check at localhost:9000, you should see a welcome page (I'm just using command line to do a quick check).<br /><pre class="brush: bash">$ curl http://localhost:9000<br /></pre><b>The next step is to Create Sample Excel template file</b><br />I have created a simple xslx file which shows displays the list of customers and their phone numbers. You can get the file <a href="https://docs.google.com/leaf?id=0B6Wx_FIAstNFNjY4YmJmZDktNzU5Yy00NjRlLWJjNWUtYzhlMjkyNjA5YzNk&amp;hl=en_US" style="color: blue;">here</a>. Below is an image for easy reference. Using jxls is a great advantage. Your excel template can contain all required formatting, formulas, macros etc which will be preserved intact. You need to use specific notation (common these days in groovy, ruby language) to indicate placement of data. Refer the below image.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-deyEnmMYEnA/TnoW5x1L3xI/AAAAAAAAAeQ/pyWc68Nui9I/s1600/screenshot_11.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="135" src="http://4.bp.blogspot.com/-deyEnmMYEnA/TnoW5x1L3xI/AAAAAAAAAeQ/pyWc68Nui9I/s320/screenshot_11.jpg" width="320" /></a> </div><div class="separator" style="clear: both; text-align: center;"><br /></div>Save this file under under <br /><pre class="brush: bash">excel-example/app/views/Application/customerphonelist.xlsx<br /></pre>Lets edit the default index.html which is under excel-example/app/views/Application/<br />The home page contains just one link to download the excel report as shown below<br /><div><span style="color: black;">#{extends 'main.html' /}<br />#{set title:'Home' /}<br /></span><span style="color: blue;">&lt;</span><span style="color: maroon;">a </span><span style="color: red;">href</span><span style="color: blue;">="@{customerphonelist()}"</span><span style="color: blue;">/&gt;</span><span style="color: black;"> Download Customer Phone Numbers Excel Report </span><span style="color: blue;">&lt;/</span><span style="color: maroon;">a</span><span style="color: blue;">&gt;</span><span style="color: black;"><br /></span></div><br />Edit the controller <b>Application.java</b> and add a method - <b>customerphonelist</b>() which outputs the excel file as shown below:<br /><pre class="brush: java">package controllers;<br />import java.util.ArrayList;<br />import java.util.Date;<br />import java.util.List;<br />import org.apache.commons.lang.RandomStringUtils;<br />import models.Customer;<br />import play.Logger;<br />import play.modules.excel.RenderExcel;<br />import play.mvc.Controller;<br />import play.mvc.With;<br /><br />@With(ExcelControllerHelper.class)<br />public class Application extends Controller {<br />    public static void index() {<br />        render();<br />    }<br />    public static void customerphonelist(){<br />     Logger.info("Generating Customer Phone List Excel report ");<br />     request.format = "xlsx";<br />        Date date = new Date();<br />        String user = "Bob";<br />        List<customer> customers = new ArrayList<customer>();<br />        for (int i = 0 ;i &lt; 10; i++){<br />         customers.add(new Customer("Mr", RandomStringUtils.randomAlphabetic(15), RandomStringUtils.randomNumeric(10)));<br />        } <br />     renderArgs.put("date", date);<br />     renderArgs.put("user", user);<br />     renderArgs.put("customers", customers);<br />     renderArgs.put(RenderExcel.RA_ASYNC, true);<br />     renderArgs.put(RenderExcel.RA_FILENAME, "customer_list_report.xlsx");<br />        render();<br />        Logger.info("Completed Customer Phone List Excel report ");<br />    }<br />} <br /></pre>Above at line no 11 - <br /><pre class="brush: java">@With(ExcelControllerHelper.class) </pre>annotation is used. ExcelControllerHelper class is part of play excel module. <a href="http://www.playframework.org/documentation/1.2.3/controllers" style="color: blue;">@With</a><span style="color: blue;"> </span>is an interceptor. This interceptor loads the excel template. <br />Line No 22 to 25 creates a Customer model class and populates it with some random data.  <br />Line No 26 to 30 puts the objects in to the renderArgs map. These objects would be available as part of the actual excel file which can be used to render the dynamic content.<br />Line No 29 is of <b>special interest</b> which sets the ASYNC to true. This is a very powerful feature of Play framework. This helps in transparent asynchronous rendering of the excel. You don't have to deal with Future, Promise, await, request.new etc and you get the power for nearly free. The existing HTTP request is suspended and then when the excel report generation is done, this thread is resumed and the response sent back to the client. Think about the fact that a large Excel table rendering might take as long as 500ms and blocking request handling thread for half second is NOT acceptable in a high performance web server like play which use only limited thread (N+1) to handle web requests. Read more about this <a href="http://www.playframework.org/documentation/1.2.3/asynchronous">here</a>.<br /><b>Last step :)</b>, Open<br /><pre class="brush: bash">http://localhost:9000</pre>and click on the<span style="color: blue;"> Download Customer Phone Numbers Excel Report </span> link. A excel report should be generated and should look some thing like below.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-EwZ-hhiSLAc/TnoYF4SwcTI/AAAAAAAAAeU/qcuIOR_6CJE/s1600/screenshot_12.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="282" src="http://4.bp.blogspot.com/-EwZ-hhiSLAc/TnoYF4SwcTI/AAAAAAAAAeU/qcuIOR_6CJE/s400/screenshot_12.jpg" width="400" /></a></div><br />That completes the example.<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/9675872-6034515788996845792?l=bnagur.blogspot.com' alt='' /></div>